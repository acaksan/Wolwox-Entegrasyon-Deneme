ğŸš€ Wolvox-WooCommerce Entegrasyonu - VeritabanÄ± BaÄŸlantÄ± ve Sorgu StandartlarÄ±

Bu belge, veritabanÄ± baÄŸlantÄ± yÃ¶netimi, sorgu optimizasyonu ve gÃ¼venlik kurallarÄ±nÄ± belirler. TÃ¼m Firebird veritabanÄ± iÅŸlemleri modÃ¼ler, gÃ¼venli ve performans odaklÄ± olmalÄ±dÄ±r.

ğŸ“Œ 1. Genel Kurallar

âœ” TÃ¼m veritabanÄ± iÅŸlemleri merkezi bir yÃ¶netim dosyasÄ± Ã¼zerinden yÃ¼rÃ¼tÃ¼lmelidir.

VeritabanÄ± baÄŸlantÄ±sÄ± database.py dosyasÄ±nda tanÄ±mlanmalÄ±dÄ±r.

TÃ¼m sorgular repositories/ klasÃ¶rÃ¼nde, ilgili varlÄ±k adÄ±na gÃ¶re ayrÄ±lmalÄ±dÄ±r.

âœ” BaÄŸlantÄ± yÃ¶netimi ve gÃ¼venliÄŸi en Ã¼st dÃ¼zeyde tutulmalÄ±dÄ±r.

VeritabanÄ± baÄŸlantÄ± bilgileri .env dosyasÄ±nda saklanmalÄ±dÄ±r.

AÃ§Ä±kta baÄŸlantÄ± bilgisi iÃ§eren dosyalar commit edilmeyecektir.

âœ” Her sorgu performans aÃ§Ä±sÄ±ndan optimize edilmelidir.

Gereksiz sorgu Ã§alÄ±ÅŸtÄ±rÄ±lmamalÄ±, JOIN ve INDEX kullanÄ±mÄ± optimize edilmelidir.

Veri setleri gereksiz yere tÃ¼m satÄ±rlarÄ± Ã§ekmemelidir.

âœ” BaÄŸlantÄ± yÃ¶netimi otomatik yapÄ±lmalÄ±dÄ±r.

BaÄŸlantÄ±lar gerektiÄŸi zaman aÃ§Ä±lmalÄ± ve iÅŸ bitiminde kapatÄ±lmalÄ±dÄ±r.

Uzun sÃ¼re aÃ§Ä±k kalan baÄŸlantÄ±lar sistem performansÄ±nÄ± dÃ¼ÅŸÃ¼rmemelidir.

ğŸ“Œ 2. Firebird VeritabanÄ± BaÄŸlantÄ± YÃ¶netimi

âœ” Tek bir baÄŸlantÄ± yÃ¶neticisi kullanÄ±lacaktÄ±r (database.py).
âœ” BaÄŸlantÄ± yÃ¶netimi Singleton tasarÄ±m deseni ile saÄŸlanmalÄ±dÄ±r.
âœ” BaÄŸlantÄ±lar dinamik olarak aÃ§Ä±lÄ±p kapanmalÄ±dÄ±r.

ğŸ“Œ Firebird VeritabanÄ± BaÄŸlantÄ± Bilgileri:

FIREBIRD_HOST=localhost
FIREBIRD_DATABASE=D:\AKINSOFT\Wolvox8\Database_FB\DEMOWOLVOX\2025\WOLVOX.FDB
FIREBIRD_USER=SYSDBA
FIREBIRD_PASSWORD=masterkey
FIREBIRD_PORT=3050
FIREBIRD_CHARSET=WIN1254
FIREBIRD_CLIENT_DLL=C:\Program Files (x86)\Firebird\Firebird_2_5\bin\fbclient.dll

ğŸ“Œ Ã–rnek Firebird BaÄŸlantÄ± YÃ¶neticisi:

import fdb
import os

class FirebirdDB:
    _instance = None

    def __new__(cls):
        if cls._instance is None:
            cls._instance = super(FirebirdDB, cls).__new__(cls)
            cls._instance.conn = fdb.connect(
                dsn=f"{os.getenv('FIREBIRD_HOST')}:{os.getenv('FIREBIRD_DATABASE')}",
                user=os.getenv("FIREBIRD_USER"),
                password=os.getenv("FIREBIRD_PASSWORD"),
                charset=os.getenv("FIREBIRD_CHARSET"),
                fb_library_name=os.getenv("FIREBIRD_CLIENT_DLL"),
                port=int(os.getenv("FIREBIRD_PORT"))
            )
            cls._instance.cursor = cls._instance.conn.cursor()
        return cls._instance

    def execute_query(self, query, params=None):
        """Parametreli SQL sorgularÄ±nÄ± gÃ¼venli bir ÅŸekilde Ã§alÄ±ÅŸtÄ±rÄ±r."""
        try:
            self._instance.cursor.execute(query, params or ())
            return self._instance.cursor.fetchall()
        except fdb.DatabaseError as e:
            print(f"VeritabanÄ± HatasÄ±: {e}")
            return None
        
    def close(self):
        """BaÄŸlantÄ±yÄ± kapatÄ±r."""
        self._instance.cursor.close()
        self._instance.conn.close()

ğŸ“Œ 3. Stok SorgularÄ±

âœ” Stok verileri repositories/stok_repository.py iÃ§inde yÃ¶netilecektir.
âœ” Sorgular optimize edilmeli ve sadece gerekli veriler Ã§ekilmelidir.
âœ” Webde gÃ¶rÃ¼necek stok kartlarÄ± ve tekil stok kartÄ± sorgularÄ± merkezi hale getirilmelidir.

ğŸ“Œ Ã–rnek Stok KartlarÄ± Sorgusu:

from database import FirebirdDB

class StokRepository:
    def __init__(self):
        self.db = FirebirdDB()
    
    def get_stok_kartlari(self, limit=100):
        """Aktif ve webde gÃ¶rÃ¼nen stok kartlarÄ±nÄ± getirir."""
        query = f"""
            SELECT FIRST {limit}
                s.BLKODU, s.STOKKODU, s.STOK_ADI, s.BARKODU, s.BIRIMI, s.KDV_ORANI,
                s.MARKASI, s.MODELI, s.GRUBU, s.ALT_GRUBU, s.WEBDE_GORUNSUN,
                s.AKTIF, s.BIRIM_AGIRLIK, s.ETICARET_ACIKLAMA, s.RESIM_YOLU,
                (SELECT COALESCE(SUM(
                    CASE WHEN sh.TUTAR_TURU = 0 THEN sh.MIKTARI ELSE -sh.MIKTARI END), 0)
                 FROM STOKHR sh WHERE sh.BLSTKODU = s.BLKODU AND sh.SILINDI = 0) as KALAN_MIKTAR,
                (SELECT FIRST 1 sf.FIYATI FROM STOK_FIYAT sf WHERE sf.BLSTKODU = s.BLKODU 
                 AND sf.FIYAT_NO = 1 AND sf.TANIMI = 'SATIÅ FÄ°YATI -1') as SATIS_FIYATI
            FROM STOK s
            WHERE s.AKTIF = 1 AND s.WEBDE_GORUNSUN = 1
            ORDER BY s.STOK_ADI
        """
        return self.db.execute_query(query)

Bu belge katÄ± kurallar iÃ§ermektedir ve bu kurallara uyulmadan veritabanÄ± iÅŸlemleri gerÃ§ekleÅŸtirilemez. ğŸš€

